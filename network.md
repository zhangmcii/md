## TCP连接时，为什么需要第三次握手，而不是两次就可以了？
防止客户端和服务器建立因网络延迟问题建立多次连接。

如果把连接看成是一个实例，那么第三次握手，可以看成它是一个"单例模式"，确保在网络延迟的环境下，始终只建议一个tcp连接。



## TCP断开连接时，为什么需要四次挥手，而不是两次就可以了？ 最后客户端等待2MSL时间的原因是什么？
两次挥手后，客户端没有数据需要发送了，但服务器端可能还存在未传送完毕的数据，所以服务器端传送完毕后，服务器端会发送连接释放报文。

等待2MSL原因：
确保客户端发送的第4次挥手能够到达。如果服务端没收到客户端发送的确认报文，那么会重新发送连接释放请求，客户端等待一段时间后就是防止这种情况。

确保网络中本连接的残余报文全部消失，避免影响后续新的连接。



## 若等待 2 MSL 的时间，客户端重发了确认，但服务端依然没收到，这个连接会一直存在吗？

服务端会不断重发 FIN，直到 超过自己设置的超时/重传次数。客户端只要还在2 MSL内，就能处理这些 FIN 并回复 ACK。
如果最后一次 ACK 依然没到服务端，最终服务端会因为 超时 主动关闭连接。


## ACK 最多存活 1 MSL，那么2 MS内服务器最多能发2次？
不是说 2 MSL 内服务端最多只能发 2 次 FIN。 服务端能发多少次，取决于它的 RTO 设置和重传次数上限。

ACK 在网络里最多存活 1 MSL，TIME_WAIT 等 2 MSL 的目的不是限制服务端只能发 2 次 FIN，而是为了让所有可能的 FIN/ACK 报文在网络中完全消失。服务端实际能发几次 FIN，取决于它的重传策略和超时时间，而不是 MSL。


## 比如在服务端在1.5MSL时发送连接释放请求，而ACK 在网络里最多存活 1 MSL，那么等待该ACK失效，已经超过了2MSL，这和你说的客户端等待 2 MSL，只是保证无论如何，旧连接的报文都消失是否吗矛盾呢？

TIME_WAIT 的 2 MSL 是动态的，从最后一个 ACK 算起。
客户端每次发送 ACK，2 MSL 计时都需要重新开始。如果在 TIME_WAIT 期间又收到了 FIN，客户端会重发 ACK，并 刷新计时器。